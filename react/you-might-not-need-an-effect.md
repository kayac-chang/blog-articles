# You Might Not Need an Effect 你可能不太需要 Effect

Effect 相當於 React 編程典範的 逃生出口。

他們讓你跳脫 React 本身，使元件能與一些外部系統同步，  
像是 非 React 元件，網路 或是 瀏覽器的 DOM。

但假如這段實作根本不會牽扯到外部系統時，此時你不應該使用到 Effect。  
(例如，你想要在某些 props 或是 state 改變時，更新元件的狀態。)

移除非必要的 Effects 將會讓你的程式更容易理解，運行更快，更少出錯。

> 你將會學到
>
> - 為何跟如何從元件中移除非必要的 Effects
> - 如何不透過 Effects 快取昂貴的運算
> - 如何不透過 Effects 重置或是調整元件狀態
> - 如何在不同事件處理中共用邏輯
> - 哪些邏輯應該要移動進事件處理
> - 如何通知父元件關於這些更新

## How to remove unnecessary Effects 如何移除非必要的 Effects

這邊有兩個常見的情境，你不應該用到 Effects：

- **你不需要 Effects 來轉換渲染時所需要的資料**  
  舉例來說，你想要在顯示列表之前先行過濾。  
  你可能覺得應該要寫個 Effect，在當列表更新時用來更動 state 變數。  
  然而，這是沒有效率的做法。

  當你更新元件的 state 時，  
  React 會先呼叫你的元件函式，運算出什麼必須被渲染到畫面上。  
  然後 React 會 "commit" 這些異動至 DOM，刷新畫面，之後才會去跑你的 Effects。  
  但如果你的 Effect 也立刻更新了元件的 state，  
  那整個渲染程序就會重來一遍！

  所以，為了避免不必要的渲染程序，請把所有的資料移到元件的最上層。  
  因為無論你的 props 或是 state 更動，程式都會自動重新運算。

- **你不需要 Effects 來處理用戶事件**  
  例如說，你想要發送 `/api/buy` POST 請求，  
  然後在用戶買下商品時跳通知。  
  在 Buy 按鈕的點擊事件中，你很明確的知道到底發生了什麼事。  
  但在 Effects 運行階段時，你並不知道用戶到底做了什麼的(例如，到底哪個按鈕被點擊了)。  
  這就是為什麼你通常會透過事件處理機制來應對相對應的用戶事件。

你需要 Effects 來同步外部系統。  
舉個例子，你可以寫個 Effect 來使 jQuery 的元件與你的 React 狀態同步。

你也可以透過 Effects 來抓資料：  
例如，你可以用當前的搜尋字來同步搜尋結果。

注意到，現代框架基本內建了很多更有效率的資料獲取機制，  
比起用 Effects 直接寫在元件裡。

為了幫助你抓到正確的感覺，我們來看些常見的例子！
